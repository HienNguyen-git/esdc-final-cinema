<link
  rel="stylesheet"
  href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css"
  integrity="sha512-KfkfwYDsLkIlwQp6LFnl8zNdLGxu9YAA1QvwINks4PhcElQSvqcyVLLD9aMhXd13uQjoXtEKNosOWaZqXgel0g=="
  crossorigin="anonymous"
  referrerpolicy="no-referrer"
/>
<div class="alert alert-warning alert-dismissible fade hide col-sm-3 position-fixed" id="warning-alert" role="alert">
  <strong>Sorry!</strong> You have used up all of the available seats for this booking.
</div>


{{schedule}}

<div class="session-panel col-sm-6">
  <h1 class="title">BOOK TICKET
    <i class="fa fa-ticket" aria-hidden="true"></i></h1>
</div>
<div id="bill-info">
  <div class="info-ticket-item">
    <h4 id="title-film" style="font-weight: bold">MOVIE NAME</h4>
    <div class="hours-date">
      <span id="time">{{schedule.start}}</span>
      <span id="date">- {{schedule.day}}</span>
      <br />
      <span id="screen"><span class="title">Show room:</span> Screen {{roomMap.id}}</span>
    </div>
    <div class="box-tickets">
      <table class="table-box-1">
        <tbody>
          <tr>
            <td class="td-first title">Amount - Price: </td>
            <td class="td-second align-right"><span id="count" class="font-weight-bold">1</span> x 45,000 VND</td>
          </tr>
          <tr id="seatrow1">
            <td class="yseat" colspan="2"><span class="title">Your seat:</span> (E12)</td>
          </tr>
        </tbody>
      </table>
      <h4 class="select-drink mt-3" style="font-weight: bold">FOOD &amp; BEVERAGES</h4>
      <table class="table-box-2">
        <tbody>
          <tr class="tr_first">
            <td class="td-first"><span class="names">iSHARE Combo</span></td>
            <td class="td-second align-right" style="width: 110px">
              <span class="sol">1</span> x 87,000 VNĐ
            </td>
          </tr>
          <tr class="tr_first">
            <td class="td-first"><span class="names">iCheese Popcorn 44oz</span></td>
            <td class="td-second align-right" style="width: 110px">
              <span class="sol">1</span> x 55,000 VNĐ
            </td>
          </tr>
          <tr class="tr_first">
            <td class="td-first"><span class="names">iBIG SHARE Combo</span></td>
            <td class="td-second align-right" style="width: 110px">
              <span class="sol">1</span> x 97,000 VNĐ
            </td>
          </tr>
          <tr class="align-right bill-total">
            <td colspan="2"><span class="title">Total:</span></td>
          </tr>
          <tr class="align-right bill-total">
            <td colspan="2"><span id="total">45,000</span><span
              > VNĐ</span></td>
          </tr>
        </tbody>
      </table>
    </div>
    <div class="schedule-item mt-3">Pay</div>
  </div>
</div>
<div class="option-panel col-sm-6">
  <div class="option-panel-section option-panel-section1">
    <h1>CHOOSE YOUR SEAT</h1>
  </div>
  <div class="option-panel-section option-panel-section4">

    <ul class="showcase">
      <li>
        <div class="seat"></div>
        <small>N/A</small>
      </li>
      <li>
        <div class="seat selected"></div>
        <small>Selected</small>
      </li>
      <li>
        <div class="seat occupied"></div>
        <small>Occupied</small>
      </li>
    </ul>

    <div class="seat-container">
      <div class="screen"></div>
      <div id="seat-group">
        <div class="row" id="row-titles">
          <div class="order"></div>
          {{!-- Generate header --}}
          {{#forLoop roomMap.numRow 1}}
            <div class="order">{{this}}</div>
          {{/forLoop}}
        </div> 

        {{#forLoop roomMap.numColumn 0}}
        <div class="row">
          <div class="order">{{#NumToText this}} {{/NumToText}}</div>
          {{#forLoop ../roomMap.numRow 0}}
            <div class="seat"></div>
          {{/forLoop}}
          <div class="order">{{#NumToText this}} {{/NumToText}}</div>
        </div>
        {{/forLoop}}

        
{{!--         
        <div class="row" id="row-titles">
          <div class="order">1</div>
          <div class="order">2</div>
          <div class="order">3</div>
          <div class="order">4</div>
          <div class="order">5</div>
          <div class="order">6</div>
          <div class="order">7</div>
          <div class="order">8</div>
        </div> 
        --}}

        {{!-- Generate sheet seat --}}

        
{{!--         
        <div class="row">
          <div class="order">H</div>
          <div class="seat"></div>
          <div class="seat"></div>
          <div class="seat"></div>
          <div class="seat"></div>
          <div class="seat occupied"></div>
          <div class="seat occupied"></div>
          <div class="seat occupied"></div>
          <div class="seat"></div>
          <div class="order">H</div>
        </div>
         --}}
      </div>
    </div>
    <p class="text-light text-center mt-3">The maximum number of seats that can be reserved is <span class="text-danger">5</span>.</p>
  </div>
</div>
<div class="option-panel col-sm-6">
  <div class="option-panel-section option-panel-section1">
    <h1>SELECT FOOD AND BEVERAGES</h1>
  </div>
  <div class="option-panel-section option-panel-section4">
  </div>
</div>

<script>
    let currentSeat = 0


  const myAlert = document.querySelector("#warning-alert")
  const container = document.querySelector(".seat-container"); 
  const seats = document.querySelectorAll(".row .seat:not(.occupied)"); 
  const count = document.getElementById("count"); 
  const total = document.getElementById("total"); 
  const movieSelect = document.getElementById("movie"); 
  const rowTitle = document.querySelector('#row-titles')

  myAlert.addEventListener('click',(e)=>{
      myAlert.classList.toggle('show')
  })
  
    let hideAlert = setTimeout(function () { 
        myAlert.classList.remove("show")
    }, 3000); 

  //Seat click event
  container.addEventListener('click', e => { 
      console.log(e.target)
      if (e.target.classList.contains('seat') && !e.target.classList.contains('occupied')) {
          if(currentSeat+1<6 || e.target.classList.contains('selected')){
            e.target.classList.toggle('selected'); 
          }else{
            clearTimeout(hideAlert)
            myAlert.classList.add("show")
            
            hideAlert = setTimeout(function () { 
                myAlert.classList.remove("show")
            }, 3000); 
            
          }
        updateSelectedCount()
    } 
    }); 
  // Initial count && total

    

    function updateSelectedCount() {
        const selectedSeats = document.querySelectorAll('.row .seat.selected');
        const seatIndex = [...selectedSeats].map((seat) => [...seats].indexOf(seat));

        localStorage.setItem('selectedSeats', JSON.stringify(seatIndex));

        tmp = JSON.stringify(seatIndex)
        console.log(tmp)
        const selectedSeatsCount = selectedSeats.length;
        currentSeat = selectedSeatsCount
        count.innerText = selectedSeatsCount;
        total.innerText = selectedSeatsCount * 2;
    }

</script>